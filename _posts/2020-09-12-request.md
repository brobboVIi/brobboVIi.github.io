---
layout: page
title:  "网络请求"
subtitle: "全面分析前端的网络请求方式"
date:   2020-09-12 16:21:21 +0530
categories: ["learn"]
---



1. ### 前言

   从我们在浏览器的地址栏输入http://brobbovii.github.io后回车，到我们看到该博客的主页，这中间经历了什么呢？简单地回答这个问题，大概是经历了域名解析、TCP的三次握手、建立TCP连接后发起HTTP请求、服务器响应HTTP请求、浏览器解析html代码，同时请求html代码中的资源（如js、css、图片等）、最后浏览器对页面进行渲染并呈现给用户。下面分别介绍一下每个过程。

2. ### 域名解析

   以Chrome浏览器为例，Chrome会解析域名对应的IP地址

   - Chrome浏览器会首先搜索浏览器自身的DNS缓存（可以使用 chrome://net-internals/#dns 来进行查看），浏览器自身的DNS缓存有效期比较短，且容纳有限，大概是1000条。如果自身的缓存中存在blog.csdn.net 对应的IP地址并且没有过期，则解析成功。
   - 如果（1）中未找到，那么Chrome会搜索操作系统自身的DNS缓存（可以在命令行下使用 ipconfig /displaydns 查看）。如果找到且没有过期则成功。
   - 如果（2）中未找到，那么尝试读取位于C:\Windows\System32\drivers\etc下的hosts文件，如果找到对应的IP地址则解析成功。
   - 如果（3）中未找到，浏览器首先会找TCP/IP参数中设置的本地DNS服务器，如果要查询的域名包含在本地配置的区域资源中，则完成域名解析，否则根据本地DNS服务器会请求根DNS服务器。
   - 本地DNS会把请求发至13台根DNS，根DNS服务器收到请求后会返回负责这个域名(.net)的服务器的一个IP，本地DNS服务器使用该IP信息联系负责.net域的这台服务器。这台负责.net域的服务器收到请求后，如果自己无法解析，会返回.net域的下一级DNS服务器地址(blog.csdn.net)给本地DNS服务器。以此类推，直至找到。

3. ### TCP的三次握手

   - #### 准备知识

     - ACK ，TCP协议规定只有ACK=1时有效，也规定连接建立后所有发送的报文的ACK必须为1。
     - SYN，在连接建立时用来同步序号。当SYN=1而ACK=0时，表明这是一个连接请求报文。对方若同意建立连接，则应在响应报文中使SYN=1和ACK=1，因此SYN置1就表示这是一个连接请求或连接接受报文。
     - FIN，用来释放一个连接。当 FIN = 1 时，表明此报文段的发送方的数据已经发送完毕，并要求释放连接。

   - #### 三次握手

     - 首先由Client发出请求连接即 SYN=1 ACK=0，TCP规定SYN=1时不能携带数据，但要消耗一个序号，因此声明自己的序号是 seq=x。
     - 然后 Server 进行回复确认，即 SYN=1 ACK=1 seq=y，ack=x+1。
     - 再然后 Client 再进行一次确认，但不用SYN 了，这时即为 ACK=1，seq=x+1， ack=y+1。

4. ### 建立TCP连接后发起HTTP请求

   TCP三次握手建立连接成功后，客户端按照指定的格式开始向服务端发送HTTP请求，服务端接收请求后，解析HTTP请求，处理完业务逻辑，最后返回一个具有标准格式的HTTP响应给客户端。

5. ### HTTP请求格式

   HTTP请求格式如下所示四部分组成，分别是请求行、请求头、空行、消息体，每部分内容占一行。

   <u>请求行：由三部分组成：分别是请求方法（GET/POST/DELETE/PUT/HEAD）、URI路径、HTTP版本号。</u>

   <u>响应头：用于说明数据的一些信息，比如数据类型、内容长度等键值对。

   空行。</u>

6. ### 浏览器解析html代码，并请求html代码中的资源
   
    ​	浏览器拿到html文件后，就开始解析其中的html代码，遇到js/css/image等静态资源时，向服务器端发起一个HTTP请求，如果服务器端返回304状态码（告诉浏览器服务器端没有修改该资源），那么浏览器会直接读取本地的该资源的缓存文件。否则开启新线程向服务器端去请求下载。（这个时候就用上keep-alive特性了，建立一次HTTP连接，可以请求多个资源。）
    
    最后，浏览器利用自己内部的工作机制，把请求到的静态资源和html代码进行渲染，再呈现给用户。
   
   
   
   
   